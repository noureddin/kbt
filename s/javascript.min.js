"use strict";const d=L.split(" ");function i(e){let t=e.length;for(var n;0!=t;)n=Math.floor(Math.random()*t),t--,[e[t],e[n]]=[e[n],e[t]];return e}const o=(e,t,n="")=>e.filter(e=>e.match(RegExp(`^[${t.replace(/-/g,"\\-")}]+$`))).filter(e=>!e.match(RegExp(`^[${n.replace(/-/g,"\\-")}]+$`))),h=()=>(new Date).getTime(),u=e=>document.querySelectorAll(e),g=t=>u("."+t).forEach(e=>e.classList.remove(t)),w=n=>{n.innerHTML=n.innerText.split("").map(e=>`<span>${e}</span>`).join(""),n.childNodes.forEach((e,t)=>{0<t&&ligature_need_break(n.childNodes[t-1].textContent,e.textContent)&&y(e,"bb")})},y=(e,t)=>e.classList.add(t),m=(e,t)=>e.classList.remove(t),f=e=>{y(e,"current-word"),w(e),e.scrollIntoView(),E=e},v=document.getElementById("completed"),n=document.getElementById("allwords"),t=document.getElementById("lesson"),_=document.getElementById("screen"),p=document.getElementById("write"),T=document.body;let E,I={};function S(){var e,t;if(E)return(e=E.innerText)===(t=p.value)?" ":e.startsWith(t)?e[t.length]:"\b"}u("#keyboard > span > *").forEach(e=>{var t;I["BS"===(t=e.innerHTML)?"\b":"SPACE"===t?" ":t.startsWith("&nbsp;")?t.split(";").pop():t[0]]=e});const K=function(){let r;return{end:function(){clearInterval(r)},start:function(){clearInterval(r),g("hihi");var e,t=S();const n=I[t];n&&(e=()=>n.classList.add("hihi"),"\b"===t?e():r=setInterval(e,5e3))}}}();function b(e,t){t||=D(n.innerText);t=(--t).toString().length;v.innerText=A(e.toString().padStart(t,"0"))}function r(e,t){var n,r,l;t&&(n=e.selectionStart,l=e.selectionEnd,r=e.value.substring(0,n),l=e.value.substring(l,e.value.length),e.value=r+t+l,e.selectionStart=e.selectionEnd=n+t.length)}const l={Backquote:!0,KeyQ:!0,KeyW:!0,KeyE:!0,KeyR:!0,KeyT:!0,KeyA:!0,KeyS:!0,KeyD:!0,KeyF:!0,KeyG:!0,KeyZ:!0,KeyX:!0,KeyC:!0,KeyV:!0,KeyB:!0};let a;p.addEventListener("keydown",e=>{var t,n=document.getElementById("emu").checked;"Shift"===e.key?a=e.code.substr(5,1):"Enter"===e.key?alert(TXT_ENTER_ALERT):!n||e.ctrlKey||e.altKey||(n=mapping[e.code])&&(e.preventDefault(),e.shiftKey?(t=l[e.code])&&"L"===a?alert(BAD_LEFT_SHIFT_ALERT):t||"R"!==a?r(p,n[1]):alert(BAD_RIGHT_SHIFT_ALERT):r(p,n[0]),p.oninput(e))}),window.addEventListener("resize",()=>{E&&E.scrollIntoView()}),window.addEventListener("load",()=>{p.value="";{var l,e,c=+window.location.hash.slice(1)||+window.location.search.slice(1)||1;(c=!c||c<1?1:c)>=d.length&&(c=d.length),window.location.hash=c,window.location.search="",l=t.value=c,_.innerHTML=(e=>{e=+l-1;var t=d[e],[n,r]=want_full_words(t)?[FULL_WORDS,FULL_WORDS_LIMIT]:[WORDS,WORDS_LIMIT],e=d.slice(0,e).reduce((e,t)=>e+t,""),e=o(n,t,e);return i(e.length>=r?i(e).slice(0,r):[...e,...i(o(n,t)).slice(0,r-e.length)])})().map(e=>`<span style="display: inline-block; width: ${.75*e.length}em">${e}</span>`).join(" "),b(0,(e=l,e=want_full_words(d[+e-1])?FULL_WORDS_LIMIT:WORDS_LIMIT)),n.innerText=A(e),m(T,"finish"),g("hi"),e=c,d[+e-1].split("").forEach(e=>I[e].classList.add("hi")),f(document.querySelector("#screen > :first-child")),p.value="",p.focus(),K.start();let a,s=0;p.oninput=e=>{e=" "===e.data;null==a&&(a=h());var t,n,r,l=E.textContent,i=p.value.trim();p.value=i;for(let e=0;e<l.length;++e){var o=E.childNodes[e];null==i[e]?(m(o,"wrong-letter"),m(o,"correct-letter")):l[e]!==i[e]?(t=o,y(t,"wrong-letter"),m(t,"correct-letter")):(t=o,m(t,"wrong-letter"),y(t,"correct-letter"))}(i.length>l.length||u(".wrong-letter").length||"\b"===S()?y:m)(E,"wrong-word"),e?(e=l===i,E.innerHTML=E.textContent,e?(y(E,"correct-word"),m(E,"wrong-word"),m(E,"current-word"),(e=E.nextSibling?.nextSibling)?(b(D(v.innerText)+1),f(e)):(e=(h()-a)/1e3,r=_.innerText.length,y(T,"finish"),_.innerHTML=(r=[n=60*(r=r)/e,n/5,r,e,n=100-100*s/r,s,+(e=c)],finish_msg_init(...r)+(+e<d.length?finish_msg_forward:finish_msg_end)(...r)+(90<=n?"":finish_msg_repeat(...r))),a=void 0,K.end(),p.oninput=()=>{})):i?(y(E,"wrong-word"),w(E),s+=1):w(E),p.value=""):s+="\b"===S(),a&&K.start()}}});
