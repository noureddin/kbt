const t=["1","2","3","4","5","6"].map(e=>"Lesson&ensp;"+e),a=e=>Math.round(e),c=e=>e.toString(),h=e=>+e,u=(e,t,n,r,o,l)=>{return e=a(e),c(e)+" letter"+(1!==e?"s":"")+" per minute ("+c(a(t))+" WPM with accuracy of "+c(a(o))+"%)."},d=(e,t,n,r,o,l,a)=>"<br>Step to "+D(a+1)+" or repeat "+D(a)+".",g=(e,t,n,r,o,l,a)=>"<br>You have finish all lessons! You can go now, or repeat "+D(a)+".",f=(e,t,n,r,o,l,a)=>"<br>but with this accuracy, it's probably better to repeat "+D(a)+".",p=L.split(" ");function l(e){let t=e.length;for(var n;0!=t;)n=Math.floor(Math.random()*t),t--,[e[t],e[n]]=[e[n],e[t]];return e}const i=(e,t,n="")=>e.filter(e=>e.match(RegExp(`^[${t.replace(/-/g,"\\-")}]+$`))).filter(e=>!e.match(RegExp(`^[${n.replace(/-/g,"\\-")}]+$`))),n=e=>p[+e-1],r=e=>(p[+e-1],100),o=(e,t)=>{e=+e-1;var n=p[e],[r,o]=[FULL_WORDS,100],t=t||o,o=p.slice(0,e).reduce((e,t)=>e+t,""),e=i(r,n,o);return l(e.length>=t?l(e).slice(0,t):[...e,...l(i(r,n)).slice(0,t-e.length)])},w=()=>(new Date).getTime(),A=e=>document.querySelector(e),s=e=>document.getElementById(e),v=e=>document.querySelectorAll(e),b=t=>v("."+t).forEach(e=>e.classList.remove(t)),y=n=>{n.innerHTML=n.innerText.split("").map(e=>`<span>${e}</span>`).join(""),n.childNodes.forEach((e,t)=>{0<t&&(n.childNodes[t-1].textContent,e.textContent)})},m=(e,t)=>e.classList.add(t),S=(e,t)=>e.classList.remove(t),x=e=>{m(e,"current-word"),y(e),e.scrollIntoView(),H=e},N=e=>{S(e,"wrong-letter"),m(e,"correct-letter")},P=e=>{m(e,"wrong-letter"),S(e,"correct-letter")},E=s("completed"),T=s("allwords"),V=s("lesson"),k=s("screen"),$=s("write"),C=document.body;let H,I={};function R(){var e,t;if(H)return(e=H.innerText)===(t=$.value)?" ":e.startsWith(t)?e[t.length]:"\b"}v("#keyboard > span > *").forEach(e=>{var t;I["BS"===(t=e.innerHTML)?"\b":"SPACE"===t?" ":t.startsWith("&nbsp;")?t.split(";").pop():t[0]]=e});const W=function(){let r;return{end:function(){clearInterval(r)},start:function(){clearInterval(r),b("hihi");var e,t=R();const n=I[t];n&&(e=()=>n.classList.add("hihi"),"\b"===t?e():r=setInterval(e,5e3))}}}();function B(e,t){t||=h(T.innerText);t=(--t).toString().length;E.innerText=c(e.toString().padStart(t,"0"))}const D=e=>'<a href="?'+e+'">'+t[+e-1]+"</a>";function play(a){var e;(a=!a||a<1?1:a)>=p.length&&(a=p.length),location.hash=a,location.search="",e=V.value=a,k.innerHTML=o(e).map(e=>`<span style="display: inline-block; width: ${.75*e.length}em">${e}</span>`).join(" "),B(0,e=r(e)),T.innerText=c(e),S(C,"finish"),b("hi"),n(a).split("").forEach(e=>I[e].classList.add("hi")),x(A("#screen > :first-child")),$.value="",$.focus(),W.start();let i,t,s=0;onblur=()=>{null!=i&&(t=w())},onfocus=()=>{null!=i&&(null==t?console.warn("How on Earth have you managed to start the lesson while not focusing the screen? Please share you wisdom and report this at https://github.com/noureddin/kbt"):i+=w()-t)},$.oninput=e=>{e=" "===e.data;null==i&&(i=w());var t,n,r=H.textContent,o=$.value.trim();$.value=o;for(let e=0;e<r.length;++e){var l=H.childNodes[e];null==o[e]?(S(l,"wrong-letter"),S(l,"correct-letter")):(r[e]!==o[e]?P:N)(l)}(o.length>r.length||v(".wrong-letter").length||"\b"===R()?m:S)(H,"wrong-word"),e?(e=r===o,H.innerHTML=H.textContent,e?(m(H,"correct-word"),S(H,"wrong-word"),S(H,"current-word"),(e=H.nextSibling?.nextSibling)?(B(h(E.innerText)+1),x(e)):(e=(w()-i)/1e3,n=k.innerText.length,m(C,"finish"),k.innerHTML=(n=[t=60*(n=n)/e,t/5,n,e,t=100-100*s/n,s,+(e=a)],u(...n)+(+e<p.length?d:g)(...n)+(90<=t?"":f(...n))),i=null,W.end(),$.oninput=null)):o?(m(H,"wrong-word"),y(H),s+=1):y(H),$.value=""):s+="\b"===R(),i&&W.start()}}function K(e,t){var n,r,o;t&&(n=e.selectionStart,o=e.selectionEnd,r=e.value.substring(0,n),o=e.value.substring(o,e.value.length),e.value=r+t+o,e.selectionStart=e.selectionEnd=n+t.length)}const U={Backquote:!0};"QWERTASDFGZXCVB".split("").forEach(e=>U["Key"+e]=!0);let q;$.onkeydown=e=>{var t,n=s("emu").checked;"Shift"===e.key?q=e.code.substr(5,1):"Enter"===e.key?alert("Use Space after each word; it's faster, and it's the usual choice"):!n||e.ctrlKey||e.altKey||(n=M[e.code])&&(e.preventDefault(),e.shiftKey?(t=U[e.code])&&"L"===q?alert("Use the right-side Shift with keys on the left side of the keyboard"):t||"R"!==q?K($,n[1]):alert("Use the left-side Shift with keys on the right side of the keyboard"):K($,n[0]),$.oninput(e))},onresize=()=>{H&&H.scrollIntoView()},onload=()=>{$.value="",play(+location.hash.slice(1)||+location.search.slice(1)||1)};